{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/marlow/Documents/Cursor-projects/slava%20jewlery/app/api/design/generate/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport OpenAI from 'openai';\n\nconst openai = new OpenAI({\n  apiKey: process.env.OPENAI_API_KEY,\n});\n\n// Image types for jewelry photography\nconst IMAGE_TYPES = [\n  {\n    type: 'packshot_front',\n    description: 'Professional packshot with clean white background, front view'\n  },\n  {\n    type: 'hero_angle', \n    description: 'Dramatic 3/4 angle with professional lighting and shadows'\n  },\n  {\n    type: 'macro_detail',\n    description: 'Extreme close-up showing intricate details and craftsmanship'\n  },\n  {\n    type: 'lifestyle_shot',\n    description: 'Elegant lifestyle context, worn or displayed naturally'\n  }\n];\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json();\n    const { user_vision, ...designData } = body;\n\n    if (!user_vision || typeof user_vision !== 'string' || user_vision.trim().length < 10) {\n      return NextResponse.json(\n        { error: 'Please provide a detailed description of your jewelry vision' },\n        { status: 400 }\n      );\n    }\n\n    if (!process.env.OPENAI_API_KEY) {\n      return NextResponse.json(\n        { error: 'OpenAI API key not configured' },\n        { status: 500 }\n      );\n    }\n\n    console.log('Generating jewelry design for:', user_vision.slice(0, 100) + '...');\n\n    // Generate multiple images in parallel\n    const imagePromises = IMAGE_TYPES.map(async (imageType) => {\n      const prompt = `Professional jewelry photography: ${user_vision}. ${imageType.description}. Studio lighting, high detail, luxury jewelry photography, 4k resolution, professional product photography`;\n\n      console.log(`Generating ${imageType.type}...`);\n      \n      try {\n        const imageResponse = await openai.images.generate({\n          model: \"dall-e-3\",\n          prompt: prompt,\n          n: 1,\n          size: \"1024x1024\",\n          quality: \"hd\",\n          style: \"natural\"\n        });\n\n        return {\n          type: imageType.type,\n          url: imageResponse.data?.[0]?.url || null,\n          prompt: prompt,\n          revised_prompt: imageResponse.data?.[0]?.revised_prompt || null\n        };\n      } catch (imageError) {\n        console.error(`Error generating ${imageType.type}:`, imageError);\n        return {\n          type: imageType.type,\n          url: null,\n          error: imageError instanceof Error ? imageError.message : 'Image generation failed'\n        };\n      }\n    });\n\n    // Wait for all images to generate\n    const images = await Promise.all(imagePromises);\n\n    // Filter out failed generations\n    const successfulImages = images.filter(img => img.url);\n    const failedImages = images.filter(img => !img.url);\n\n    console.log(`Generated ${successfulImages.length}/${images.length} images successfully`);\n\n    if (successfulImages.length === 0) {\n      return NextResponse.json(\n        { error: 'Failed to generate any images. Please try again.' },\n        { status: 500 }\n      );\n    }\n\n    // Generate design specifications using GPT-4\n    let specifications = null;\n    try {\n      const specPrompt = `As a master jeweler, create detailed manufacturing specifications for this custom jewelry piece:\n\nDesign Vision: ${user_vision}\n\nProvide concise specifications including:\n1. Materials and dimensions\n2. Stone specifications  \n3. Manufacturing techniques\n4. Estimated timeline\n5. Price range\n\nKeep response under 300 words and focus on technical details.`;\n\n      const specResponse = await openai.chat.completions.create({\n        model: \"gpt-4o\",\n        messages: [{ role: \"user\", content: specPrompt }],\n        max_tokens: 400,\n        temperature: 0.3\n      });\n\n      specifications = specResponse.choices[0].message.content;\n    } catch (specError) {\n      console.error('Error generating specifications:', specError);\n      specifications = 'Specifications generation temporarily unavailable. Our team will provide detailed specs upon request.';\n    }\n\n    const response = {\n      success: true,\n      images: successfulImages,\n      specifications,\n      user_vision,\n      generated_at: new Date().toISOString(),\n      ...(failedImages.length > 0 && { \n        warnings: `${failedImages.length} image(s) failed to generate` \n      })\n    };\n\n    return NextResponse.json(response);\n\n  } catch (error) {\n    console.error('Design generation error:', error);\n    \n    return NextResponse.json(\n      { \n        error: error instanceof Error ? error.message : 'Internal server error',\n        success: false \n      },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":"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"}}]
}